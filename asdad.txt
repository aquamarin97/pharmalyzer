app/views/ui/ui.py

adjustment sonrası final sınıflandırma 
analyzed_well_count -> self.total_sample_count_label = QtWidgets.QLabel(self.centralwidget),
"Güvenli Bölge"_count -> self.safezone_count_label = QtWidgets.QLabel(self.centralwidget),
"Riskli Alan"_count -> self.riskyarea_count_label = QtWidgets.QLabel(self.centralwidget),
healthy_count -> self.healthy_count_label = QtWidgets.QLabel(self.centralwidget),
carrier_count -> self.carry_count_label = QtWidgets.QLabel(self.centralwidget),
belirsiz_count -> self.uncertain_count_label = QtWidgets.QLabel(self.centralwidget),
healthy_avg -> self.healthy_avg = QtWidgets.QLabel(self.centralwidget),
Std -> self.std = QtWidgets.QLabel(self.centralwidget)
CV -> self.cv = QtWidgets.QLabel(self.centralwidget),

healthy_avg, Std ve CV "Güvenli Bölge" de ve "İstatistik Oranı" 0.8-1.2 arasında olan değerler arasından hesaplanmalıdır. 
ui.checkBox_istatistik.toggled.connect(self.stats_toggled)'a bağlı olarak eğer True ise:
CalculateWithoutReference'tan elde edilen sonuçlar, 
Eğer False ise: CalculateWithReferance'tan elde edilen sonuçlar kullanılmalıdır.
Anlamadığın bir yer olursa soru sorabilirsin. EĞer anladıysan CODEX' için prompt oluştururken bu düzenlememiz için eğer yeni bir klasör veya dosya oluşturmamız gerekiyorsa folder path üzerinden belirt. Ben bu dosyaları oluşturup CODEX'e promptu gönderirim.  
Folder Structure:
pharmalyzer/
├── app
│   ├── bootstrap
│   │   ├── resources.py
│   │   └── splash.py
│   ├── common
│   │   └── widgets
│   │       └── dialogs.py
│   ├── constants
│   │   ├── app_styles.py
│   │   ├── app_text_key.py
│   │   ├── asset_paths.py
│   │   ├── export_presets.py
│   │   ├── pcr_graph_style.py
│   │   ├── regression_plot_style.py
│   │   └── table_config.py
│   ├── controllers
│   │   ├── analysis
│   │   │   └── colored_box_controller.py
│   │   ├── app
│   │   │   ├── drag_drop_controller.py
│   │   │   └── export_controller.py
│   │   ├── graph
│   │   │   └── graph_controller.py
│   │   ├── interaction
│   │   │   └── interaction_controller.py
│   │   ├── table
│   │   │   ├── highlight_sync.py
│   │   │   ├── selection_sync.py
│   │   │   ├── table_controller.py
│   │   │   └── table_interaction_controller.py
│   │   ├── well
│   │   │   └── well_edit_controller.py
│   │   └── main_controller.py
│   ├── exceptions
│   │   ├── base.py
│   │   ├── handler.py
│   │   └── types.py
│   ├── i18n
│   │   ├── translations
│   │   │   └── tr.json
│   │   ├── __init__.py
│   │   └── loader.py
│   ├── licensing
│   │   ├── __init__.py
│   │   ├── manager.py
│   │   ├── ui.py
│   │   └── validator.py
│   ├── logging
│   │   └── setup.py
│   ├── models
│   │   ├── workers
│   │   │   └── analysis_worker.py
│   │   └── main_model.py
│   ├── services
│   │   ├── analysis_steps
│   │   │   ├── calculate_regration.py
│   │   │   ├── calculate_with_referance.py
│   │   │   ├── calculate_without_referance.py
│   │   │   ├── configurate_result_csv.py
│   │   │   └── csv_processor.py
│   │   ├── export
│   │   │   ├── exporters
│   │   │   │   ├── excel_exporter.py
│   │   │   │   └── tsv_exporter.py
│   │   │   ├── export_options.py
│   │   │   └── export_service.py
│   │   ├── graph
│   │   │   └── pcr_graph_layout_service.py
│   │   ├── analysis_service.py
│   │   ├── colored_box_service.py
│   │   ├── data_store.py
│   │   ├── interaction_store.py
│   │   ├── pcr_data_service.py
│   │   ├── pipeline.py
│   │   ├── rdml_service.py
│   │   └── regression_plot_service.py
│   ├── utils
│   │   ├── rdml
│   │   │   ├── rdml_parser.py
│   │   │   └── rdml_reader.py
│   │   ├── validators
│   │   │   └── well_validators.py
│   │   ├── pandas_utils.py
│   │   ├── qt_table_utils.py
│   │   └── well_mapping.py
│   └── views
│       ├── plotting
│       │   ├── pcr_graph
│       │   │   ├── axes.py
│       │   │   ├── drawing.py
│       │   │   ├── hit_test.py
│       │   │   ├── interactions.py
│       │   │   ├── renderer.py
│       │   │   ├── selection.py
│       │   │   └── styles.py
│       │   ├── regression
│       │   │   ├── adapters.py
│       │   │   ├── annotations.py
│       │   │   ├── handles.py
│       │   │   ├── interaction.py
│       │   │   ├── legends.py
│       │   │   ├── renderer.py
│       │   │   └── styles.py
│       │   └── pyqtgraph_regression_renderer.py
│       ├── table
│       │   ├── drop_down_delegate.py
│       │   ├── editable_table_model.py
│       │   └── table_view_widget.py
│       ├── ui
│       │   └── ui.py
│       ├── widgets
│       │   ├── pcr_graph_interactor.py
│       │   ├── pcr_graph_view.py
│       │   ├── pcr_plate_widget.py
│       │   └── regression_graph_view.py
│       └── main_view.py
├── main.py




# app\views\main_view.py
class MainView(QMainWindow):
    """
    View: UI kurar + UI günceller.
    Controller'ı bilmez. Eventleri Qt sinyalleri ile dışarı verir.
    """

    analyze_requested = QtCore.pyqtSignal()
    import_requested = QtCore.pyqtSignal()
    export_requested = QtCore.pyqtSignal()
    clear_requested = QtCore.pyqtSignal()
    stats_toggled = QtCore.pyqtSignal(bool)
    carrier_range_changed = QtCore.pyqtSignal(float)
    uncertain_range_changed = QtCore.pyqtSignal(float)
    close_requested = QtCore.pyqtSignal()
    
    def __init__(self):
        super().__init__()
        self.ui = Ui_MainWindow()
        self.ui.setupUi(self)

        self._enabled_state = {
            "analyze": True,
            "import": True,
            "export": True,
            "clear": True,
        }

        self._wire_ui_signals()

    def _wire_ui_signals(self) -> None:
        ui = self.ui
        ui.pushButton_analiz_et.clicked.connect(self.analyze_requested)
        ui.pushButton_iceaktar.clicked.connect(self.import_requested)
        ui.pushButton_disaaktar.clicked.connect(self.export_requested)
        ui.pushButton_temizle.clicked.connect(self.clear_requested)

        ui.checkBox_istatistik.toggled.connect(self.stats_toggled)
        ui.doubleSpinBox_tasiyici.valueChanged.connect(self.carrier_range_changed)
        ui.doubleSpinBox_belirsiz.valueChanged.connect(self.uncertain_range_changed) 

# app\controllers\main_controller.py
class MainController:
    def __init__(self, view: MainView, model: MainModel):
        self.view = view
        self.model = model

        self.export_controller = ExportController()
        self.drag_drop_controller: DragDropController | None = None
        self.table_controller: AppTableController | None = None

        self.graph_drawer: PCRGraphView | None = None
        self.regression_graph_view: RegressionGraphView | None = None
        self.graph_controller: GraphController | None = None

        self.plate_widget: PCRPlateWidget | None = None
        self.interaction_store = InteractionStore()
        self.interaction_controller: InteractionController | None = None
        self.pcr_data_service = PCRDataService()

        self._wire_model_signals()
        self._wire_view_signals()

        self._initialize_components()
        self._t_analyze_clicked = None
        self._t_worker_finished = None

    # -------------------- Wiring --------------------
    def _wire_view_signals(self) -> None:
        v = self.view
        v.analyze_requested.connect(self._on_analyze_requested)
        v.import_requested.connect(self._on_import_requested)
        v.export_requested.connect(self._on_export_requested)
        v.clear_requested.connect(self._initialize_components)

        v.stats_toggled.connect(self._on_stats_toggled)
        v.carrier_range_changed.connect(lambda val: self._validate_and_set_range(val, "carrier"))
        v.uncertain_range_changed.connect(lambda val: self._validate_and_set_range(val, "uncertain"))
        v.close_requested.connect(self._on_close_requested)

    def _on_stats_toggled(self, checked: bool) -> None:
        self.model.colored_box_controller.set_check_box_status(bool(checked))
        self.model.set_checkbox_status(bool(checked))  

# app\services\analysis_steps\calculate_with_referance.py
class CalculateWithReferance:
    def __init__(self, referance_well: str, carrier_range: float, uncertain_range: float):
        self.df: pd.DataFrame | None = None
        self.referance_well = str(referance_well)
        self.carrier_range = float(carrier_range)
        self.uncertain_range = float(uncertain_range)
        self.last_success = True
        self.initial_static_value = None

    def process(self, df: pd.DataFrame | None = None) -> pd.DataFrame:
        if df is None:
            raise ValueError("CalculateWithReferance.process Pipeline tarafından df ile çağrılmalıdır.")
        if df.empty:
            raise ValueError("İşlenecek veri bulunamadı.")

        self.df = df  # Pipeline kontratı: mümkünse copy etme; pipeline yönetecek
        self.last_success = self._set_reference_value()

        valid_mask = (self.df["Uyarı"].isnull()) | (self.df["Uyarı"] == "Düşük RFU Değeri")
        valid_data = self.df[valid_mask].copy()
        invalid_data = self.df[~valid_mask].copy()

        valid_data = self._finalize_data(valid_data)
        out = pd.concat([valid_data, invalid_data], ignore_index=True)
        return out

    def _set_reference_value(self) -> bool:
        if not self.referance_well or pd.isna(self.referance_well):
            raise ValueError("Referans kuyu boş. Lütfen geçerli bir referans kuyu giriniz.")

        if self.df is None:
            raise ValueError("DataFrame yok.")

        if "Kuyu No" not in self.df.columns or "Δ Ct" not in self.df.columns:
            raise ValueError("'Kuyu No' veya 'Δ Ct' sütunu eksik.")

        if self.referance_well not in set(self.df["Kuyu No"].astype(str).values):
            raise ValueError(f"Referans kuyu '{self.referance_well}' bulunamadı.")

        vals = self.df.loc[self.df["Kuyu No"] == self.referance_well, "Δ Ct"].values
        if len(vals) == 0:
            raise ValueError(f"Referans kuyu '{self.referance_well}' için Δ Ct bulunamadı.")

        self.initial_static_value = vals[0]
        if pd.isna(self.initial_static_value):
            # referans kuyusu var ama ΔCt boş: fatal yapmayıp step başarısız sayalım
            return False
        return True

    def _finalize_data(self, valid_data: pd.DataFrame) -> pd.DataFrame:
        if self.initial_static_value is None or pd.isna(self.initial_static_value):
            # referans başarısızsa valid_data'yı bozmadan döndür
            return valid_data

        valid_data["Δ_Δ Ct"] = valid_data["Δ Ct"] - self.initial_static_value
        valid_data["Standart Oranı"] = 2 ** -valid_data["Δ_Δ Ct"]
        valid_data.loc[valid_data["Standart Oranı"] <= 0.7, "Standart Oranı"] -= 0.00

        carrier_range = self.carrier_range
        uncertain_range = self.uncertain_range

        valid_data["Referans Hasta Sonucu"] = valid_data["Standart Oranı"].apply(
            lambda x: (
                "Sağlıklı"
                if x > uncertain_range
                else (
                    "Belirsiz"
                    if carrier_range < x <= uncertain_range
                    else (
                        "Taşıyıcı"
                        if 0.1 < x <= carrier_range
                        else "Tekrar"
                    )
                )
            )
        )
        return valid_data
